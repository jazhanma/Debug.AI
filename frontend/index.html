<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeCraftr - Modern Development Environment</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0A0C10]">
  <!-- Hero Background -->
  <div class="fixed inset-0 z-0">
    <div class="absolute inset-0 bg-gradient-to-b from-[#0A0C10] via-transparent to-[#0A0C10]"></div>
    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80" 
         class="w-full h-full object-cover opacity-40" 
         alt="Space background">
  </div>

  <!-- Main Layout -->
  <div class="relative z-10 flex min-h-screen">
    <!-- Sidebar Toggle -->
    <button id="sidebarToggle" 
      class="fixed top-6 left-6 z-50 bg-black/30 backdrop-blur-md p-3 rounded-full hover:bg-black/40 transition-all duration-300 border border-white/10">
      <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
      </svg>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full w-96 transform -translate-x-full transition-transform duration-300 ease-in-out">
      <div class="h-full bg-black/80 backdrop-blur-xl border-r border-white/10 p-6 flex flex-col">
        <div class="pt-16 pb-8 text-center">
          <h2 class="text-2xl font-playfair text-white font-bold">AI Assistant</h2>
          <p class="text-white/60 mt-2 font-inter">Your coding companion</p>
        </div>
        
        <!-- Chat Container -->
        <div id="chat-container" class="flex-1 overflow-y-auto space-y-4 pr-2">
          <!-- Messages will appear here -->
        </div>

        <!-- Chat Input -->
        <div class="mt-4">
          <div class="relative">
            <input id="chatInput" 
              type="text" 
              placeholder="Message AI Assistant..."
              class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-500/30">
            <button id="sendButton"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-white/60 hover:text-white/90 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 transition-all duration-300">
      <div class="max-w-5xl mx-auto pt-20">
        <!-- Header -->
        <div class="text-center mb-12">
          <h1 class="text-5xl font-playfair text-white font-bold mb-4">CodeCraftr</h1>
          <p class="text-white/60 font-inter">Craft your code in an immersive environment</p>
        </div>

        <!-- Code Editor Section -->
        <div class="bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-6 mb-8">
          <div class="flex justify-between items-center mb-6">
            <select id="codeLanguage" 
              class="bg-black/50 text-white border border-white/10 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/30">
              <option value="python">Python</option>
              <option value="javascript">JavaScript</option>
              <!-- Other language options -->
            </select>
            
            <div class="flex gap-4">
              <button onclick="executeCode()" 
                class="px-6 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg border border-blue-500/30 transition-all duration-300">
                Run Code
              </button>
              <button onclick="analyzeCode()" 
                class="px-6 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg border border-purple-500/30 transition-all duration-300">
                Analyze
              </button>
            </div>
          </div>

          <textarea id="codeInput" 
            class="w-full h-64 bg-black/50 text-white/90 font-mono text-sm rounded-xl p-4 border border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500/30"
            placeholder="Write your code here..."></textarea>
        </div>

        <!-- Output Sections -->
        <div class="grid grid-cols-2 gap-6">
          <div class="bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-6">
            <h3 class="text-white/80 font-inter font-semibold mb-4">Execution Output</h3>
            <div id="executionOutput" class="font-mono text-sm text-white/70 min-h-[100px]"></div>
          </div>
          
          <div class="bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-6">
            <h3 class="text-white/80 font-inter font-semibold mb-4">Analysis Results</h3>
            <div id="analysisOutput" class="font-mono text-sm text-white/70 min-h-[100px]"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Game Panel -->
    <div id="gamePanel" class="fixed right-0 top-0 h-full w-96 transform translate-x-full transition-transform duration-300 ease-in-out">
      <div class="h-full bg-gradient-to-b from-gray-900 to-gray-800 shadow-2xl p-4 flex flex-col">
        <!-- Game Header -->
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-white">Flappy Code Bird</h3>
          <div class="flex gap-2">
            <button id="restartGame" class="text-gray-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
            </button>
            <button id="closeGame" class="text-gray-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Game Canvas -->
        <canvas id="gameCanvas" class="bg-gray-800 rounded-xl mb-4"></canvas>
        
        <!-- Score Display -->
        <div class="text-center mb-4">
          <p class="text-white">Score: <span id="gameScore" class="font-bold">0</span></p>
          <p class="text-white">High Score: <span id="highScore" class="font-bold">0</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Toggle Button -->
  <button id="toggleGame" 
    class="fixed top-6 right-6 z-50 bg-black/30 backdrop-blur-md p-3 rounded-full hover:bg-black/40 transition-all duration-300 border border-white/10">
    <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
  </button>

  <!-- Learning Hub -->
  <div id="learningHub" class="fixed right-0 top-0 h-full w-96 transform translate-x-full transition-all duration-300 bg-black/80 backdrop-blur-xl border-l border-white/10">
    <!-- Learning Hub Header -->
    <div class="p-6 border-b border-white/10">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-white">Learning Hub</h2>
            <button id="closeLearningHub" class="text-white/60 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <!-- Progress Overview -->
        <div class="mt-4 p-4 rounded-xl bg-white/5">
            <div class="flex items-center justify-between mb-2">
                <span class="text-white/80">Level 1</span>
                <span class="text-white/80">100 XP</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2">
                <div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div>
            </div>
        </div>
    </div>

    <!-- Main Content Tabs -->
    <div class="p-4">
        <div class="flex space-x-2 mb-4">
            <button class="tab-button active" data-tab="challenges">Challenges</button>
            <button class="tab-button" data-tab="achievements">Achievements</button>
            <button class="tab-button" data-tab="leaderboard">Leaderboard</button>
            <button class="tab-button" data-tab="games">Games</button>
        </div>

        <!-- Challenges Tab -->
        <div id="challenges" class="tab-content active">
            <div class="challenge-card">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-semibold text-white">Daily Challenge</h3>
                    <span class="px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 text-sm">500 XP</span>
                </div>
                <p class="text-white/70 mb-3">Create a function that reverses a string without using built-in methods.</p>
                <button class="w-full py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">
                    Start Challenge
                </button>
            </div>
        </div>

        <!-- Achievements Tab -->
        <div id="achievements" class="tab-content hidden">
            <div class="grid grid-cols-2 gap-4">
                <div class="achievement-card">
                    <div class="achievement-icon">üèÜ</div>
                    <h4 class="text-white font-medium">First Solution</h4>
                    <p class="text-white/60 text-sm">Complete your first challenge</p>
                </div>
                <!-- More achievements... -->
            </div>
        </div>

        <!-- Leaderboard Tab -->
        <div id="leaderboard" class="tab-content hidden">
            <div class="leaderboard-entry">
                <span class="rank">1</span>
                <span class="name">CodeMaster</span>
                <span class="score">2,500 XP</span>
            </div>
            <!-- More entries... -->
        </div>

        <!-- Games Tab -->
        <div id="games" class="tab-content hidden">
            <div class="grid grid-cols-2 gap-4">
                <div class="game-card">
                    <div class="game-icon">üê¶</div>
                    <h4 class="text-white font-medium">Flappy Code</h4>
                    <p class="text-white/60 text-sm">Current Best: 25</p>
                </div>
                <!-- More games... -->
            </div>
        </div>
    </div>
  </div>

  <!-- Learning Hub Toggle Button -->
  <button id="toggleLearningHub" 
    class="fixed top-6 right-20 z-50 bg-black/30 backdrop-blur-md p-3 rounded-full hover:bg-black/40 transition-all duration-300 border border-white/10">
    <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
    </svg>
  </button>

  <!-- Styles -->
  <style>
    /* Message Bubbles */
    .message-bubble {
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .user-message {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.3);
        color: rgba(255, 255, 255, 0.9);
    }

    .assistant-message {
        background: rgba(168, 85, 247, 0.2);
        border: 1px solid rgba(168, 85, 247, 0.3);
        color: rgba(255, 255, 255, 0.9);
    }

    .tab-button {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        color: rgba(255, 255, 255, 0.6);
        transition: color 0.2s;
    }

    .tab-button:hover {
        color: rgba(255, 255, 255, 0.9);
    }

    .tab-button.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .challenge-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .achievement-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.75rem;
        padding: 1rem;
        text-align: center;
    }

    .achievement-icon {
        font-size: 1.875rem;
        margin-bottom: 0.5rem;
    }

    .leaderboard-entry {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.5rem;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
    }

    .game-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.75rem;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .game-card:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .game-icon {
        font-size: 2.25rem;
        margin-bottom: 0.5rem;
    }

    .rank {
        width: 2rem;
        height: 2rem;
        border-radius: 9999px;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.9);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    /* Fonts */
    .font-playfair {
        font-family: 'Playfair Display', serif;
    }
    
    .font-inter {
        font-family: 'Inter', sans-serif;
    }

    /* Animations */
    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    @keyframes pulse {
        0%, 100% { opacity: 0.7; }
        50% { opacity: 0.4; }
    }
  </style>

  <!-- Add the Snake Game Canvas (add this before the closing body tag) -->
  <div id="snakeGameModal" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden z-50 flex items-center justify-center">
    <div class="relative bg-black/80 p-6 rounded-2xl border border-white/10">
        <button id="closeSnakeGame" class="absolute top-4 right-4 text-white/60 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <h3 class="text-2xl font-bold text-white mb-4">Snake.js</h3>
        <div class="relative">
            <canvas id="snakeCanvas" width="400" height="400" class="border border-white/10 rounded-lg"></canvas>
            <div id="snakeScore" class="absolute top-4 right-4 text-white font-mono">Score: 0</div>
        </div>
        <div class="mt-4 text-center text-white/60">Use arrow keys to control the snake</div>
    </div>
  </div>

  <!-- Add Tetris Game Modal -->
  <div id="tetrisGameModal" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden z-50 flex items-center justify-center">
    <div class="relative bg-black/80 p-6 rounded-2xl border border-white/10">
        <button id="closeTetris" class="absolute top-4 right-4 text-white/60 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <h3 class="text-2xl font-bold text-white mb-4">Tetris.js</h3>
        <div class="flex gap-6">
            <canvas id="tetrisCanvas" width="300" height="600" class="border border-white/10 rounded-lg"></canvas>
            <div class="text-white">
                <div id="tetrisScore" class="text-2xl font-mono mb-4">Score: 0</div>
                <div id="tetrisLevel" class="text-xl font-mono mb-4">Level: 1</div>
                <div id="tetrisNext" class="border border-white/10 p-4 rounded-lg">
                    <div class="text-sm mb-2">Next Piece:</div>
                    <canvas id="nextPieceCanvas" width="100" height="100"></canvas>
                </div>
                <div class="mt-4 text-sm text-white/60">
                    Controls:<br>
                    ‚Üê ‚Üí : Move<br>
                    ‚Üë : Rotate<br>
                    ‚Üì : Soft Drop<br>
                    Space : Hard Drop
                </div>
            </div>
        </div>
    </div>
  </div>

  <script>
    // Sidebar Toggle
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('sidebar');
      const toggleButton = document.getElementById('sidebarToggle');
      const toggleIcon = document.getElementById('toggleIcon');
      const mainContent = document.querySelector('.main-content');

      function toggleSidebar() {
        sidebar.classList.toggle('-translate-x-full');
        toggleIcon.classList.toggle('rotate-180');
        if (!sidebar.classList.contains('-translate-x-full')) {
          mainContent.style.marginLeft = '384px';
        } else {
          mainContent.style.marginLeft = '0';
        }
      }

      toggleButton.addEventListener('click', toggleSidebar);
    });

    // Code Execution
    async function executeCode() {
      const code = document.getElementById('codeInput').value;
      const language = document.getElementById('codeLanguage').value;
      const outputDiv = document.getElementById('executionOutput');

      try {
        const response = await fetch('http://127.0.0.1:8080/execute', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code, language })
        });

        const data = await response.json();
        outputDiv.textContent = data.output || data.error;
      } catch (error) {
        outputDiv.textContent = `Error: ${error.message}`;
      }
    }

    // Code Analysis
    async function analyzeCode() {
      const code = document.getElementById('codeInput').value;
      const language = document.getElementById('codeLanguage').value;
      const outputDiv = document.getElementById('analysisOutput');

      try {
        const response = await fetch('http://127.0.0.1:8080/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code, language })
        });

        const data = await response.json();
        if (data.analysis) {
          outputDiv.innerHTML = `
            <div class="space-y-2">
              <p><strong>Suggestions:</strong> ${data.analysis.suggestions}</p>
              <p><strong>Issues:</strong> ${data.analysis.issues}</p>
              <p><strong>Best Practices:</strong> ${data.analysis.best_practices}</p>
            </div>
          `;
        } else {
          outputDiv.textContent = data.error;
        }
      } catch (error) {
        outputDiv.textContent = `Error: ${error.message}`;
      }
    }

    // Chat functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Get DOM elements
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const chatContainer = document.getElementById('chat-container');
        let chatMessages = [];

        // Add event listeners
        chatInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        });

        // Add click event for send button
        sendButton.addEventListener('click', function() {
            sendChatMessage();
        });

        async function sendChatMessage() {
            const message = chatInput.value.trim();
            
            if (message) {
                // Add user message
                chatMessages.push({
                    text: message,
                    isUser: true,
                    timestamp: new Date()
                });
                
                // Clear input
                chatInput.value = '';
                
                // Update display
                updateChatDisplay();
                
                // Add loading message
                const loadingMessage = createMessageElement('Thinking...', false);
                loadingMessage.classList.add('loading-message');
                chatContainer.appendChild(loadingMessage);
                
                try {
                    // Make API call to backend
                    const response = await fetch('http://127.0.0.1:8080/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: message })
                    });

                    const data = await response.json();
                    
                    // Remove loading message
                    chatContainer.removeChild(loadingMessage);
                    
                    // Add AI response
                    chatMessages.push({
                        text: data.response || 'Sorry, I could not process that request.',
                        isUser: false,
                        timestamp: new Date()
                    });
                    
                    // Update display
                    updateChatDisplay();
                    
                } catch (error) {
                    // Remove loading message
                    chatContainer.removeChild(loadingMessage);
                    
                    // Add error message
                    chatMessages.push({
                        text: 'Sorry, there was an error processing your message. Please try again.',
                        isUser: false,
                        timestamp: new Date()
                    });
                    
                    // Update display
                    updateChatDisplay();
                }
            }
        }

        function createMessageElement(message, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${isUser ? 'user-message' : 'assistant-message'}`;
            messageDiv.textContent = message;
            return messageDiv;
        }

        function updateChatDisplay() {
            chatContainer.innerHTML = '';
            chatMessages.forEach(msg => {
                const messageElement = createMessageElement(msg.text, msg.isUser);
                chatContainer.appendChild(messageElement);
            });
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    });

    // Add these styles
    document.head.insertAdjacentHTML('beforeend', `
        <style>
            .message-bubble {
                padding: 12px 16px;
                margin: 8px 0;
                border-radius: 12px;
                max-width: 85%;
                word-wrap: break-word;
                animation: fadeIn 0.3s ease-out;
            }
            
            .user-message {
                margin-left: auto;
                background: rgba(59, 130, 246, 0.2);
                border: 1px solid rgba(59, 130, 246, 0.3);
                color: rgba(255, 255, 255, 0.9);
            }
            
            .assistant-message {
                margin-right: auto;
                background: rgba(139, 92, 246, 0.2);
                border: 1px solid rgba(139, 92, 246, 0.3);
                color: rgba(255, 255, 255, 0.9);
            }
            
            .loading-message {
                opacity: 0.7;
                animation: pulse 1.5s ease-in-out infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 0.7; }
                50% { opacity: 0.4; }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            #sendButton {
                cursor: pointer;
                padding: 8px;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            #sendButton:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            #sendButton:active {
                transform: translateY(-50%) scale(0.95);
            }
        </style>
    `);

    // Game Panel Toggle
    document.addEventListener('DOMContentLoaded', function() {
      const gamePanel = document.getElementById('gamePanel');
      const toggleButton = document.getElementById('toggleGame');
      const closeButton = document.getElementById('closeGame');
      const mainContent = document.querySelector('.main-content');
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      let gameLoop;
      let isGameRunning = false;

      // Game panel toggle
      function toggleGamePanel() {
        const isPanelVisible = !gamePanel.classList.contains('translate-x-full');
        
        if (isPanelVisible) {
          gamePanel.classList.add('translate-x-full');
          mainContent.style.marginRight = '0';
          if (isGameRunning) pauseGame();
        } else {
          gamePanel.classList.remove('translate-x-full');
          mainContent.style.marginRight = '384px';
          if (!isGameRunning) startGame();
        }
      }

      toggleButton.addEventListener('click', toggleGamePanel);
      closeButton.addEventListener('click', toggleGamePanel);

      // Updated Game Variables
      let bird = {
        x: 50,
        y: 150,
        velocity: 0,
        gravity: 0.3,     // Reduced gravity
        jump: -6,         // Adjusted jump power
        size: 15,
        rotation: 0
      };

      let pipes = [];
      let score = 0;
      let highScore = localStorage.getItem('flappyHighScore') || 0;
      let backgroundGradient;
      let gameSpeed = 1.5;  // Slower game speed

      // Set canvas size
      function resizeCanvas() {
        canvas.width = canvas.parentElement.clientWidth - 32; // Adjust for padding
        canvas.height = 400;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      // Create gradient for background (add this after canvas setup)
      function createBackgroundGradient() {
        backgroundGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        backgroundGradient.addColorStop(0, '#1a1f3c');
        backgroundGradient.addColorStop(1, '#2d3250');
      }

      // Updated game functions
      function startGame() {
        isGameRunning = true;
        bird.y = canvas.height / 2;
        bird.velocity = 0;
        bird.rotation = 0;
        pipes = [];
        score = 0;
        updateScore();
        if (!gameLoop) {
          gameLoop = setInterval(updateGame, 20);
        }
        createBackgroundGradient();
      }

      function pauseGame() {
        isGameRunning = false;
        clearInterval(gameLoop);
        gameLoop = null;
      }

      function updateScore() {
        document.getElementById('gameScore').textContent = score;
        document.getElementById('highScore').textContent = highScore;
      }

      function drawBird() {
        ctx.save();
        ctx.translate(bird.x, bird.y);
        
        // Smooth rotation based on velocity
        bird.rotation = Math.max(-30, Math.min(30, bird.velocity * 3));
        ctx.rotate(bird.rotation * Math.PI / 180);
        
        // Bird body gradient
        const birdGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, bird.size);
        birdGradient.addColorStop(0, '#ffd700');  // Core yellow
        birdGradient.addColorStop(0.7, '#ffa500'); // Orange edge
        birdGradient.addColorStop(1, '#ff8c00');   // Dark orange outline
        
        // Draw bird body
        ctx.fillStyle = birdGradient;
        ctx.beginPath();
        ctx.arc(0, 0, bird.size, 0, Math.PI * 2);
        ctx.fill();
        
        // Draw wing
        ctx.fillStyle = '#ffd700';
        ctx.beginPath();
        ctx.ellipse(-2, -2, bird.size/2, bird.size/3, Math.PI/4, 0, Math.PI * 2);
        ctx.fill();
        
        // Draw eye
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(bird.size/2, -bird.size/3, bird.size/4, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(bird.size/2 + 2, -bird.size/3, bird.size/8, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.restore();
      }

      function drawPipe(x, y, height, isTop) {
        const pipeWidth = 60;  // Wider pipes
        const pipeGradient = ctx.createLinearGradient(x, 0, x + pipeWidth, 0);
        pipeGradient.addColorStop(0, '#43a047');   // Dark green edge
        pipeGradient.addColorStop(0.5, '#4caf50'); // Middle green
        pipeGradient.addColorStop(1, '#43a047');   // Dark green edge
        
        ctx.fillStyle = pipeGradient;
        
        if (isTop) {
          // Top pipe
          ctx.fillRect(x, 0, pipeWidth, height);
          
          // Pipe cap
          ctx.fillStyle = '#2e7d32';
          ctx.fillRect(x - 5, height - 20, pipeWidth + 10, 20);
        } else {
          // Bottom pipe
          ctx.fillRect(x, y, pipeWidth, canvas.height - y);
          
          // Pipe cap
          ctx.fillStyle = '#2e7d32';
          ctx.fillRect(x - 5, y, pipeWidth + 10, 20);
        }
      }

      function updateGame() {
        // Clear canvas with gradient background
        ctx.fillStyle = backgroundGradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw clouds (decorative background)
        drawClouds();
        
        // Update bird
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;
        
        // Draw bird with rotation
        drawBird();
        
        // Generate pipes
        if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 250) {
          const gap = 180;  // Increased gap
          const minHeight = 50;
          const maxHeight = canvas.height - gap - minHeight;
          const pipeY = Math.random() * (maxHeight - minHeight) + minHeight;
          pipes.push({
            x: canvas.width,
            y: pipeY,
            gap: gap,
            counted: false
          });
        }
        
        // Update and draw pipes
        pipes.forEach((pipe, index) => {
          pipe.x -= gameSpeed;  // Use gameSpeed for slower movement
          
          // Draw pipes with gradient
          drawPipe(pipe.x, pipe.y + pipe.gap, pipe.y, true);  // Top pipe
          drawPipe(pipe.x, pipe.y + pipe.gap, pipe.y, false); // Bottom pipe
          
          // More forgiving collision detection
          const hitbox = bird.size * 0.7; // Even smaller hitbox
          if (
            bird.x + hitbox > pipe.x + 5 && // Add offset to make it more forgiving
            bird.x - hitbox < pipe.x + 55 && // Reduced collision width
            (bird.y - hitbox < pipe.y || bird.y + hitbox > pipe.y + pipe.gap)
          ) {
            if (score > highScore) {
              highScore = score;
              localStorage.setItem('flappyHighScore', highScore);
            }
            startGame();
          }
          
          // Score points
          if (!pipe.counted && pipe.x < bird.x) {
            score++;
            pipe.counted = true;
            updateScore();
            
            // Visual feedback for scoring
            showScorePopup();
          }
          
          // Remove off-screen pipes
          if (pipe.x < -60) {
            pipes.splice(index, 1);
          }
        });
        
        // More forgiving boundary checking
        if (bird.y < bird.size) {
          bird.y = bird.size;
          bird.velocity = 0;
        }
        if (bird.y > canvas.height - bird.size) {
          bird.y = canvas.height - bird.size;
          bird.velocity = 0;
          startGame();
        }

        // Add velocity dampening
        if (bird.velocity > 0) {
          bird.velocity *= 0.95; // Slow down falling
        }

        // Add maximum falling speed
        if (bird.velocity > 10) {
          bird.velocity = 10;
        }
      }

      // Add decorative clouds
      function drawClouds() {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        const time = Date.now() / 5000;
        for (let i = 0; i < 3; i++) {
          const x = ((canvas.width + 100) * ((i + time) % 1)) - 50;
          const y = 50 + i * 40;
          drawCloud(x, y);
        }
      }

      function drawCloud(x, y) {
        ctx.beginPath();
        ctx.arc(x, y, 30, 0, Math.PI * 2);
        ctx.arc(x + 25, y - 10, 25, 0, Math.PI * 2);
        ctx.arc(x + 25, y + 10, 25, 0, Math.PI * 2);
        ctx.arc(x + 50, y, 30, 0, Math.PI * 2);
        ctx.fill();
      }

      // Score popup animation
      function showScorePopup() {
        const popup = document.createElement('div');
        popup.className = 'score-popup';
        popup.textContent = '+1';
        document.body.appendChild(popup);
        setTimeout(() => popup.remove(), 1000);
      }

      // Updated control system
      function initializeControls() {
        // Keyboard controls
        window.addEventListener('keydown', function(e) {
          if (e.key === 'w' || e.key === 'W') {
            e.preventDefault(); // Prevent page scrolling
            jump();
          }
        });

        // Mouse/touch controls
        canvas.addEventListener('mousedown', function(e) {
          e.preventDefault();
          jump();
        });

        canvas.addEventListener('touchstart', function(e) {
          e.preventDefault();
          jump();
        });
      }

      // Updated jump function with better physics
      function jump() {
        if (isGameRunning) {
          // Reset velocity for consistent jump height
          bird.velocity = bird.jump;
          
          // Add minimum velocity cap to prevent too fast falling
          if (bird.velocity > 15) {
            bird.velocity = 15;
          }
        }
      }

      // Add game state
      let gameStarted = false;
      
      // Show initial instructions
      function showInstructions() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = 'white';
        ctx.font = '24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Press SPACE or CLICK to start', canvas.width/2, canvas.height/2);
        ctx.font = '18px Arial';
        ctx.fillText('Use SPACE or CLICK to jump', canvas.width/2, canvas.height/2 + 40);
      }
      
      // Start with instructions
      showInstructions();
      
      // First jump starts the game
      function startGameOnInput(e) {
        if (!gameStarted) {
          gameStarted = true;
          startGame();
          // Remove this listener after first use
          window.removeEventListener('keydown', startGameOnInput);
          canvas.removeEventListener('mousedown', startGameOnInput);
          canvas.removeEventListener('touchstart', startGameOnInput);
        }
      }
      
      window.addEventListener('keydown', startGameOnInput);
      canvas.addEventListener('mousedown', startGameOnInput);
      canvas.addEventListener('touchstart', startGameOnInput);

      // Initialize controls when game starts
      initializeControls();
    });

    // Add visual feedback for controls
    function addJumpEffect() {
      const effect = document.createElement('div');
      effect.className = 'jump-effect';
      canvas.parentElement.appendChild(effect);
      setTimeout(() => effect.remove(), 300);
    }

    // Learning Hub Toggle
    document.addEventListener('DOMContentLoaded', function() {
      const learningHub = document.getElementById('learningHub');
      const toggleButton = document.getElementById('toggleLearningHub');
      const closeButton = document.getElementById('closeLearningHub');
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      // Toggle Learning Hub
      toggleButton.addEventListener('click', () => {
        learningHub.classList.toggle('translate-x-full');
      });

      closeButton.addEventListener('click', () => {
        learningHub.classList.add('translate-x-full');
      });

      // Tab Switching
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabName = button.dataset.tab;
          
          // Update active tab button
          tabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          
          // Show active tab content
          tabContents.forEach(content => {
            content.classList.add('hidden');
            if (content.id === tabName) {
              content.classList.remove('hidden');
            }
          });
        });
      });
    });

    // Game & Learning System
    class LearningSystem {
        constructor() {
            this.user = {
                xp: 0,
                level: 1,
                achievements: [],
                completedChallenges: [],
                gameScores: {}
            };

            this.challenges = [
                {
                    id: 'ch1',
                    title: 'String Reversal',
                    description: 'Create a function that reverses a string without using built-in methods.',
                    difficulty: 'Easy',
                    xpReward: 100,
                    template: 'function reverseString(str) {\n  // Your code here\n}',
                    testCases: [
                        { input: 'hello', expected: 'olleh' },
                        { input: 'javascript', expected: 'tpircsavaj' }
                    ]
                },
                {
                    id: 'ch2',
                    title: 'FizzBuzz',
                    description: 'Write a function that prints numbers from 1 to n. For multiples of 3, print "Fizz". For multiples of 5, print "Buzz".',
                    difficulty: 'Easy',
                    xpReward: 150,
                    template: 'function fizzBuzz(n) {\n  // Your code here\n}',
                    testCases: [
                        { input: 15, expected: ['1','2','Fizz','4','Buzz','Fizz','7','8','Fizz','Buzz','11','Fizz','13','14','FizzBuzz'] }
                    ]
                },
                {
                    id: 'ch3',
                    title: 'Array Sum',
                    description: 'Create a function that returns the sum of all numbers in an array.',
                    difficulty: 'Easy',
                    xpReward: 120,
                    template: 'function arraySum(numbers) {\n  // Your code here\n}',
                    testCases: [
                        { input: [1, 2, 3, 4, 5], expected: 15 },
                        { input: [-1, -2, 3, 4], expected: 4 }
                    ]
                },
                {
                    id: 'ch4',
                    title: 'Palindrome Check',
                    description: 'Write a function that checks if a string is a palindrome.',
                    difficulty: 'Medium',
                    xpReward: 200,
                    template: 'function isPalindrome(str) {\n  // Your code here\n}',
                    testCases: [
                        { input: 'racecar', expected: true },
                        { input: 'hello', expected: false }
                    ]
                }
            ];

            this.achievements = [
                {
                    id: 'ach1',
                    title: 'First Steps',
                    description: 'Complete your first challenge',
                    icon: 'üéØ',
                    condition: (user) => user.completedChallenges.length >= 1
                },
                {
                    id: 'ach2',
                    title: 'Code Warrior',
                    description: 'Complete 5 challenges',
                    icon: '‚öîÔ∏è',
                    condition: (user) => user.completedChallenges.length >= 5
                }
                // More achievements...
            ];

            this.initializeUI();
            this.loadUserData();
            this.setupEventListeners();
        }

        initializeUI() {
            // Update XP and level display
            this.updateProgressDisplay();
            this.renderChallenges();
            this.renderAchievements();
            this.initializeLeaderboard();
            this.setupGames();
        }

        updateProgressDisplay() {
            const xpToNextLevel = this.getXPForNextLevel();
            const progress = (this.user.xp % 1000) / 10; // Assuming 1000 XP per level
            
            document.querySelector('.progress-level').textContent = `Level ${this.user.level}`;
            document.querySelector('.progress-xp').textContent = `${this.user.xp} XP`;
            document.querySelector('.progress-bar').style.width = `${progress}%`;
        }

        renderChallenges() {
            const challengesContainer = document.getElementById('challenges');
            challengesContainer.innerHTML = this.challenges.map(challenge => `
                <div class="challenge-card" data-challenge-id="${challenge.id}">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-semibold text-white">${challenge.title}</h3>
                        <span class="px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 text-sm">${challenge.xpReward} XP</span>
                    </div>
                    <p class="text-white/70 mb-3">${challenge.description}</p>
                    <button class="start-challenge w-full py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">
                        Start Challenge
                    </button>
                </div>
            `).join('');
        }

        renderAchievements() {
            const achievementsContainer = document.getElementById('achievements');
            achievementsContainer.innerHTML = this.achievements.map(achievement => `
                <div class="achievement-card ${this.hasAchievement(achievement.id) ? 'unlocked' : 'locked'}">
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4 class="text-white font-medium">${achievement.title}</h4>
                    <p class="text-white/60 text-sm">${achievement.description}</p>
                </div>
            `).join('');
        }

        initializeLeaderboard() {
            // Simulated leaderboard data
            const leaderboardData = [
                { name: 'CodeMaster', score: 2500 },
                { name: 'ByteNinja', score: 2200 },
                { name: 'AlgoWhiz', score: 2000 }
            ];

            const leaderboardContainer = document.getElementById('leaderboard');
            leaderboardContainer.innerHTML = leaderboardData.map((entry, index) => `
                <div class="leaderboard-entry">
                    <span class="rank">${index + 1}</span>
                    <span class="name">${entry.name}</span>
                    <span class="score">${entry.score} XP</span>
                </div>
            `).join('');
        }

        setupGames() {
            const gamesContainer = document.getElementById('games');
            const games = [
                { id: 'flappy', title: 'Flappy Code', icon: 'üê¶', bestScore: this.user.gameScores.flappy || 0 },
                { id: 'snake', title: 'Code Snake', icon: 'üêç', bestScore: this.user.gameScores.snake || 0 },
                { id: 'tetris', title: 'Tetris.js', icon: 'üü¶', bestScore: this.user.gameScores.tetris || 0 }
            ];

            gamesContainer.innerHTML = games.map(game => `
                <div class="game-card" data-game-id="${game.id}">
                    <div class="game-icon">${game.icon}</div>
                    <h4 class="text-white font-medium">${game.title}</h4>
                    <p class="text-white/60 text-sm">Best Score: ${game.bestScore}</p>
                </div>
            `).join('');
        }

        setupEventListeners() {
            // Challenge events
            document.querySelectorAll('.start-challenge').forEach(button => {
                button.addEventListener('click', (e) => {
                    const challengeCard = e.target.closest('.challenge-card');
                    const challengeId = challengeCard.dataset.challengeId;
                    this.startChallenge(challengeId);
                });
            });

            // Game events
            document.querySelectorAll('.game-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const gameId = e.target.closest('.game-card').dataset.gameId;
                    this.startGame(gameId);
                });
            });
        }

        startChallenge(challengeId) {
            const challenge = this.challenges.find(c => c.id === challengeId);
            if (!challenge) return;

            // Update code editor with challenge
            const editor = document.querySelector('#codeInput');
            if (editor) {
                editor.value = challenge.template;
                
                // Update language selector if it exists
                const langSelector = document.querySelector('#codeLanguage');
                if (langSelector) {
                    langSelector.value = 'python'; // or whatever language the challenge uses
                }
                
                // Update challenge info display
                this.updateChallengeInfo(challenge);
                
                // Close the learning hub if it's open
                const learningHub = document.getElementById('learningHub');
                if (learningHub) {
                    learningHub.classList.add('translate-x-full');
                }
                
                // Focus the editor
                editor.focus();
            }
        }

        updateChallengeInfo(challenge) {
            // Create or update challenge info display
            let infoDiv = document.getElementById('challengeInfo');
            if (!infoDiv) {
                infoDiv = document.createElement('div');
                infoDiv.id = 'challengeInfo';
                infoDiv.className = 'fixed top-4 right-4 bg-black/50 backdrop-blur-sm p-4 rounded-xl border border-white/10 text-white z-50';
                document.body.appendChild(infoDiv);
            }

            infoDiv.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold">${challenge.title}</h3>
                    <span class="px-2 py-1 rounded-full bg-blue-500/20 text-blue-400 text-sm">${challenge.xpReward} XP</span>
                </div>
                <p class="text-white/70 text-sm mb-3">${challenge.description}</p>
            `;
        }
    }

    // Initialize the learning system
    const learningSystem = new LearningSystem();

    // Update Learning System to use the new challenge system
    if (window.learningSystem) {
        learningSystem.startChallenge = function(challengeId) {
            window.challengeSystem.startChallenge(challengeId);
        };
    }

    // Add Snake Game Implementation
    class SnakeGame {
        constructor() {
            this.canvas = document.getElementById('snakeCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.scoreElement = document.getElementById('snakeScore');
            this.gridSize = 20;
            this.tileCount = 20;
            this.snake = [
                { x: 10, y: 10 }
            ];
            this.food = this.generateFood();
            this.dx = 0;
            this.dy = 0;
            this.score = 0;
            this.gameLoop = null;
            this.speed = 100;
            
            this.setupControls();
        }

        generateFood() {
            return {
                x: Math.floor(Math.random() * this.tileCount),
                y: Math.floor(Math.random() * this.tileCount)
            };
        }

        setupControls() {
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowUp':
                        if (this.dy === 0) {
                            this.dx = 0;
                            this.dy = -1;
                        }
                        break;
                    case 'ArrowDown':
                        if (this.dy === 0) {
                            this.dx = 0;
                            this.dy = 1;
                        }
                        break;
                    case 'ArrowLeft':
                        if (this.dx === 0) {
                            this.dx = -1;
                            this.dy = 0;
                        }
                        break;
                    case 'ArrowRight':
                        if (this.dx === 0) {
                            this.dx = 1;
                            this.dy = 0;
                        }
                        break;
                }
            });
        }

        update() {
            const head = { x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy };

            // Check wall collision
            if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                this.gameOver();
                return;
            }

            // Check self collision
            for (let i = 0; i < this.snake.length; i++) {
                if (head.x === this.snake[i].x && head.y === this.snake[i].y) {
                    this.gameOver();
                    return;
                }
            }

            // Move snake
            this.snake.unshift(head);

            // Check food collision
            if (head.x === this.food.x && head.y === this.food.y) {
                this.score += 10;
                this.scoreElement.textContent = `Score: ${this.score}`;
                this.food = this.generateFood();
                this.speed = Math.max(50, this.speed - 2);
            } else {
                this.snake.pop();
            }
        }

        draw() {
            // Clear canvas
            this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

            // Draw snake
            this.ctx.fillStyle = '#4ade80';
            this.snake.forEach((segment, i) => {
                this.ctx.fillRect(
                    segment.x * this.gridSize,
                    segment.y * this.gridSize,
                    this.gridSize - 1,
                    this.gridSize - 1
                );
            });

            // Draw food
            this.ctx.fillStyle = '#f87171';
            this.ctx.fillRect(
                this.food.x * this.gridSize,
                this.food.y * this.gridSize,
                this.gridSize - 1,
                this.gridSize - 1
            );
        }

        gameOver() {
            clearInterval(this.gameLoop);
            this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            this.ctx.fillStyle = 'white';
            this.ctx.font = '30px Arial';
            this.ctx.textAlign = 'center';
            this.ctx.fillText('Game Over!', this.canvas.width/2, this.canvas.height/2);
            
            // Update high score
            if (learningSystem) {
                learningSystem.updateGameScore('snake', this.score);
            }
        }

        start() {
            this.snake = [{ x: 10, y: 10 }];
            this.food = this.generateFood();
            this.dx = 0;
            this.dy = 0;
            this.score = 0;
            this.speed = 100;
            this.scoreElement.textContent = 'Score: 0';
            
            if (this.gameLoop) clearInterval(this.gameLoop);
            
            this.gameLoop = setInterval(() => this.update(), this.speed);
        }
    }

    // Update Learning System to handle the Snake game
    LearningSystem.prototype.initSnakeGame = function() {
        const modal = document.getElementById('snakeGameModal');
        const closeBtn = document.getElementById('closeSnakeGame');
        
        modal.classList.remove('hidden');
        
        if (!this.snakeGame) {
            this.snakeGame = new SnakeGame();
        }
        
        this.snakeGame.start();
        
        closeBtn.onclick = () => {
            modal.classList.add('hidden');
            clearInterval(this.snakeGame.gameLoop);
        };
    };

    LearningSystem.prototype.updateGameScore = function(gameId, score) {
        if (!this.user.gameScores[gameId] || score > this.user.gameScores[gameId]) {
            this.user.gameScores[gameId] = score;
            this.saveUserData();
            this.setupGames(); // Refresh games display
            
            // Check for game-related achievements
            this.checkAchievements();
        }
    };

    // Add Tetris Implementation
    class Tetris {
        constructor() {
            this.canvas = document.getElementById('tetrisCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.nextCanvas = document.getElementById('nextPieceCanvas');
            this.nextCtx = this.nextCanvas.getContext('2d');
            this.scoreElement = document.getElementById('tetrisScore');
            this.levelElement = document.getElementById('tetrisLevel');
            
            this.blockSize = 30;
            this.cols = 10;
            this.rows = 20;
            this.grid = Array(this.rows).fill().map(() => Array(this.cols).fill(0));
            
            this.score = 0;
            this.level = 1;
            this.gameLoop = null;
            this.dropInterval = 1000;
            
            this.currentPiece = null;
            this.nextPiece = null;
            
            this.pieces = [
                [[1,1,1,1]], // I
                [[1,1,1],[0,1,0]], // T
                [[1,1,1],[1,0,0]], // L
                [[1,1,1],[0,0,1]], // J
                [[1,1],[1,1]], // O
                [[1,1,0],[0,1,1]], // Z
                [[0,1,1],[1,1,0]] // S
            ];
            
            this.colors = [
                '#00f0f0', // cyan
                '#f0a000', // orange
                '#0000f0', // blue
                '#f0f000', // yellow
                '#00f000', // green
                '#f00000', // red
                '#a000f0'  // purple
            ];
            
            this.setupControls();
        }
        
        setupControls() {
            document.addEventListener('keydown', (e) => {
                if (!this.currentPiece) return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        this.movePiece(-1, 0);
                        break;
                    case 'ArrowRight':
                        this.movePiece(1, 0);
                        break;
                    case 'ArrowDown':
                        this.movePiece(0, 1);
                        break;
                    case 'ArrowUp':
                        this.rotatePiece();
                        break;
                    case ' ':
                        this.hardDrop();
                        break;
                }
            });
        }
        
        // More Tetris methods...
        // (I'll continue with the rest of the implementation in the next part)
    }

    // Add new achievements
    const newAchievements = [
        {
            id: 'ach_snake_50',
            title: 'Snake Charmer',
            description: 'Score 50 points in Snake game',
            icon: 'üêç',
            condition: (user) => user.gameScores.snake >= 50
        },
        {
            id: 'ach_tetris_1000',
            title: 'Block Master',
            description: 'Score 1000 points in Tetris',
            icon: 'üü¶',
            condition: (user) => user.gameScores.tetris >= 1000
        },
        {
            id: 'ach_challenges_10',
            title: 'Challenge Champion',
            description: 'Complete 10 coding challenges',
            icon: 'üèÜ',
            condition: (user) => user.completedChallenges.length >= 10
        },
        {
            id: 'ach_daily_streak',
            title: 'Consistency King',
            description: 'Complete challenges 5 days in a row',
            icon: 'üî•',
            condition: (user) => user.dailyStreak >= 5
        }
    ];

    // Add these achievements to the existing achievements array in the LearningSystem constructor

    // Add new tutorial system
    class TutorialSystem {
        constructor() {
            this.tutorials = [
                {
                    id: 'tut_1',
                    title: 'Getting Started',
                    steps: [
                        {
                            title: 'Welcome to CodeCraftr!',
                            content: 'Let\'s learn how to use the platform.',
                            target: '#learningHub'
                        },
                        {
                            title: 'Challenges',
                            content: 'Complete coding challenges to earn XP and level up.',
                            target: '#challenges'
                        },
                        {
                            title: 'Games',
                            content: 'Play coding-themed games to practice while having fun!',
                            target: '#games'
                        }
                    ]
                }
            ];
            this.currentTutorial = null;
            this.currentStep = 0;
        }
        
        startTutorial(tutorialId) {
            // Tutorial implementation...
        }
    }

    // Update Learning System to include tutorials
    LearningSystem.prototype.initTutorialSystem = function() {
        this.tutorialSystem = new TutorialSystem();
        // Check if first time user
        if (!this.user.completedTutorials || this.user.completedTutorials.length === 0) {
            this.tutorialSystem.startTutorial('tut_1');
        }
    };

    // Continue Tetris class implementation
    Tetris.prototype.start = function() {
        this.grid = Array(this.rows).fill().map(() => Array(this.cols).fill(0));
        this.score = 0;
        this.level = 1;
        this.updateScore(0);
        this.currentPiece = this.getRandomPiece();
        this.nextPiece = this.getRandomPiece();
        this.drawNextPiece();
        
        if (this.gameLoop) clearInterval(this.gameLoop);
        this.gameLoop = setInterval(() => this.update(), this.dropInterval);
    };

    Tetris.prototype.getRandomPiece = function() {
        const index = Math.floor(Math.random() * this.pieces.length);
        return {
            shape: this.pieces[index],
            color: this.colors[index],
            x: Math.floor(this.cols / 2) - Math.floor(this.pieces[index][0].length / 2),
            y: 0
        };
    };

    Tetris.prototype.drawNextPiece = function() {
        this.nextCtx.clearRect(0, 0, this.nextCanvas.width, this.nextCanvas.height);
        const piece = this.nextPiece;
        const blockSize = 25;
        const offsetX = (this.nextCanvas.width - piece.shape[0].length * blockSize) / 2;
        const offsetY = (this.nextCanvas.height - piece.shape.length * blockSize) / 2;
        
        piece.shape.forEach((row, y) => {
            row.forEach((value, x) => {
                if (value) {
                    this.nextCtx.fillStyle = piece.color;
                    this.nextCtx.fillRect(
                        offsetX + x * blockSize,
                        offsetY + y * blockSize,
                        blockSize - 1,
                        blockSize - 1
                    );
                }
            });
        });
    };

    Tetris.prototype.update = function() {
        if (!this.movePiece(0, 1)) {
            this.placePiece();
            this.clearLines();
            this.currentPiece = this.nextPiece;
            this.nextPiece = this.getRandomPiece();
            this.drawNextPiece();
            
            if (this.checkGameOver()) {
                this.gameOver();
                return;
            }
        }
        this.draw();
    };

    Tetris.prototype.movePiece = function(dx, dy) {
        const newX = this.currentPiece.x + dx;
        const newY = this.currentPiece.y + dy;
        
        if (this.isValidMove(newX, newY, this.currentPiece.shape)) {
            this.currentPiece.x = newX;
            this.currentPiece.y = newY;
            return true;
        }
        return false;
    };

    Tetris.prototype.rotatePiece = function() {
        const rotated = this.currentPiece.shape[0].map((_, i) =>
            this.currentPiece.shape.map(row => row[i]).reverse()
        );
        
        if (this.isValidMove(this.currentPiece.x, this.currentPiece.y, rotated)) {
            this.currentPiece.shape = rotated;
        }
    };

    Tetris.prototype.hardDrop = function() {
        while (this.movePiece(0, 1)) {}
        this.update();
    };

    Tetris.prototype.isValidMove = function(x, y, shape) {
        return shape.every((row, dy) =>
            row.every((value, dx) =>
                !value || // Empty space in piece
                (x + dx >= 0 && // Not off left side
                 x + dx < this.cols && // Not off right side
                 y + dy < this.rows && // Not off bottom
                 y + dy >= 0 && // Not off top
                 !this.grid[y + dy]?.[x + dx]) // No collision with placed pieces
            )
        );
    };

    Tetris.prototype.placePiece = function() {
        this.currentPiece.shape.forEach((row, y) => {
            row.forEach((value, x) => {
                if (value) {
                    const gridY = this.currentPiece.y + y;
                    const gridX = this.currentPiece.x + x;
                    if (gridY >= 0 && gridY < this.rows && gridX >= 0 && gridX < this.cols) {
                        this.grid[gridY][gridX] = this.currentPiece.color;
                    }
                }
            });
        });
    };

    Tetris.prototype.clearLines = function() {
        let linesCleared = 0;
        
        for (let y = this.rows - 1; y >= 0; y--) {
            if (this.grid[y].every(cell => cell)) {
                this.grid.splice(y, 1);
                this.grid.unshift(Array(this.cols).fill(0));
                linesCleared++;
                y++; // Check the same row again
            }
        }
        
        if (linesCleared > 0) {
            const points = [0, 100, 300, 500, 800][linesCleared] * this.level;
            this.updateScore(points);
        }
    };

    Tetris.prototype.updateScore = function(points) {
        this.score += points;
        this.level = Math.floor(this.score / 1000) + 1;
        this.dropInterval = Math.max(100, 1000 - (this.level - 1) * 100);
        
        if (this.gameLoop) {
            clearInterval(this.gameLoop);
            this.gameLoop = setInterval(() => this.update(), this.dropInterval);
        }
        
        this.scoreElement.textContent = `Score: ${this.score}`;
        this.levelElement.textContent = `Level: ${this.level}`;
    };

    Tetris.prototype.checkGameOver = function() {
        return this.grid[0].some(cell => cell);
    };

    Tetris.prototype.gameOver = function() {
        clearInterval(this.gameLoop);
        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.fillStyle = 'white';
        this.ctx.font = '30px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.fillText('Game Over!', this.canvas.width/2, this.canvas.height/2);
        
        // Update high score
        if (learningSystem) {
            learningSystem.updateGameScore('tetris', this.score);
        }
    };

    Tetris.prototype.draw = function() {
        // Clear canvas
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw grid
        this.grid.forEach((row, y) => {
            row.forEach((color, x) => {
                if (color) {
                    this.ctx.fillStyle = color;
                    this.ctx.fillRect(
                        x * this.blockSize,
                        y * this.blockSize,
                        this.blockSize - 1,
                        this.blockSize - 1
                    );
                }
            });
        });
        
        // Draw current piece
        if (this.currentPiece) {
            this.ctx.fillStyle = this.currentPiece.color;
            this.currentPiece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        this.ctx.fillRect(
                            (this.currentPiece.x + x) * this.blockSize,
                            (this.currentPiece.y + y) * this.blockSize,
                            this.blockSize - 1,
                            this.blockSize - 1
                        );
                    }
                });
            });
        }
    };

    // Update Learning System to handle Tetris game
    LearningSystem.prototype.initTetrisGame = function() {
        const modal = document.getElementById('tetrisGameModal');
        const closeBtn = document.getElementById('closeTetris');
        
        modal.classList.remove('hidden');
        
        if (!this.tetrisGame) {
            this.tetrisGame = new Tetris();
        }
        
        this.tetrisGame.start();
        
        closeBtn.onclick = () => {
            modal.classList.add('hidden');
            clearInterval(this.tetrisGame.gameLoop);
        };
    };

    // Update the game instructions to only show inside the game modal
    document.addEventListener('DOMContentLoaded', function() {
        // Remove the fixed instruction text at the top
        const instructionElements = document.querySelectorAll('.fixed.top-4, .game-instructions, [class*="instruction"]');
        instructionElements.forEach(el => el.remove());
        
        // Remove the text content
        const headerText = document.querySelector('h1 + div');
        if (headerText && headerText.textContent.includes('Press')) {
            headerText.remove();
        }
    });
  </script>

  <!-- Add additional styles -->
  <style>
    .achievement-card.locked {
        opacity: 0.5;
        filter: grayscale(1);
    }

    .achievement-card.unlocked {
        animation: unlockAchievement 0.5s ease-out;
    }

    @keyframes unlockAchievement {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .completed-badge {
        animation: fadeIn 0.3s ease-out;
    }

    .game-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Hide any remaining instruction elements */
    .fixed.top-4,
    .game-instructions,
    [class*="instruction"] {
        display: none !important;
    }

    /* Remove the space where the text was */
    body > .fixed.top-4 {
        display: none !important;
    }

    #challengeInfo {
        z-index: 1000;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
    }

    .challenge-card .start-challenge {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .challenge-card .start-challenge:hover {
        background: rgba(59, 130, 246, 0.3);
        transform: translateY(-1px);
    }

    .challenge-card .start-challenge:active {
        transform: translateY(0px);
    }
  </style>
</body>
</html>
